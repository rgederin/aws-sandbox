{
  "version": 3,
  "sources": ["fields.ts"],
  "sourcesContent": ["import { Token, IResolvable } from '../../core';\nimport { findReferencedPaths, jsonPathString, JsonPathToken, renderObject, renderInExpression, jsonPathFromAny } from './private/json-path';\n\n/**\n * Extract a field from the State Machine data or context\n * that gets passed around between states\n *\n * @see https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-paths.html\n */\nexport class JsonPath {\n  /**\n   * Special string value to discard state input, output or result\n   */\n  public static readonly DISCARD = 'DISCARD';\n\n  /**\n   * Instead of using a literal string, get the value from a JSON path\n   */\n  public static stringAt(path: string): string {\n    validateJsonPath(path);\n    return new JsonPathToken(path).toString();\n  }\n\n  /**\n   * Instead of using a literal string list, get the value from a JSON path\n   */\n  public static listAt(path: string): string[] {\n    // does not apply to task context\n    validateDataPath(path);\n    return Token.asList(new JsonPathToken(path));\n  }\n\n  /**\n   * Instead of using a literal number, get the value from a JSON path\n   */\n  public static numberAt(path: string): number {\n    validateJsonPath(path);\n    return Token.asNumber(new JsonPathToken(path));\n  }\n\n  /**\n   * Reference a complete (complex) object in a JSON path location\n   */\n  public static objectAt(path: string): IResolvable {\n    validateJsonPath(path);\n    return new JsonPathToken(path);\n  }\n\n  /**\n   * Use the entire data structure\n   *\n   * Will be an object at invocation time, but is represented in the CDK\n   * application as a string.\n   */\n  public static get entirePayload(): string {\n    return new JsonPathToken('$').toString();\n  }\n\n  /**\n   * Determines if the indicated string is an encoded JSON path\n   *\n   * @param value string to be evaluated\n   */\n  public static isEncodedJsonPath(value: string): boolean {\n    return !!jsonPathString(value);\n  }\n\n  /**\n   * Return the Task Token field\n   *\n   * External actions will need this token to report step completion\n   * back to StepFunctions using the `SendTaskSuccess` or `SendTaskFailure`\n   * calls.\n   */\n  public static get taskToken(): string {\n    return new JsonPathToken('$$.Task.Token').toString();\n  }\n\n  /**\n   * Use the entire context data structure\n   *\n   * Will be an object at invocation time, but is represented in the CDK\n   * application as a string.\n   */\n  public static get entireContext(): string {\n    return new JsonPathToken('$$').toString();\n  }\n\n  /**\n   * Make an intrinsic States.Array expression\n   *\n   * Combine any number of string literals or JsonPath expressions into an array.\n   *\n   * Use this function if the value of an array element directly has to come\n   * from a JSON Path expression (either the State object or the Context object).\n   *\n   * If the array contains object literals whose values come from a JSON path\n   * expression, you do not need to use this function.\n   *\n   * @see https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-intrinsic-functions.html\n   */\n  public static array(...values: string[]): string {\n    return new JsonPathToken(`States.Array(${values.map(renderInExpression).join(', ')})`).toString();\n  }\n\n  /**\n   * Make an intrinsic States.Format expression\n   *\n   * This can be used to embed JSON Path variables inside a format string.\n   *\n   * For example:\n   *\n   * ```ts\n   * sfn.JsonPath.format('Hello, my name is {}.', sfn.JsonPath.stringAt('$.name'))\n   * ```\n   *\n   * @see https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-intrinsic-functions.html\n   */\n  public static format(formatString: string, ...values: string[]): string {\n    const allArgs = [formatString, ...values];\n    return new JsonPathToken(`States.Format(${allArgs.map(renderInExpression).join(', ')})`).toString();\n  }\n\n  /**\n   * Make an intrinsic States.StringToJson expression\n   *\n   * During the execution of the Step Functions state machine, parse the given\n   * argument as JSON into its object form.\n   *\n   * For example:\n   *\n   * ```ts\n   * sfn.JsonPath.stringToJson(sfn.JsonPath.stringAt('$.someJsonBody'))\n   * ```\n   *\n   * @see https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-intrinsic-functions.html\n   */\n  public static stringToJson(jsonString: string): IResolvable {\n    return new JsonPathToken(`States.StringToJson(${renderInExpression(jsonString)})`);\n  }\n\n  /**\n   * Make an intrinsic States.JsonToString expression\n   *\n   * During the execution of the Step Functions state machine, encode the\n   * given object into a JSON string.\n   *\n   * For example:\n   *\n   * ```ts\n   * sfn.JsonPath.jsonToString(sfn.JsonPath.objectAt('$.someObject'))\n   * ```\n   *\n   * @see https://docs.aws.amazon.com/step-functions/latest/dg/amazon-states-language-intrinsic-functions.html\n   */\n  public static jsonToString(value: any): string {\n    const path = jsonPathFromAny(value);\n    if (!path) {\n      throw new Error('Argument to JsonPath.jsonToString() must be a JsonPath object');\n    }\n\n    return new JsonPathToken(`States.JsonToString(${path})`).toString();\n  }\n\n  private constructor() {}\n}\n\n/**\n * Extract a field from the State Machine data that gets passed around between states\n *\n * @deprecated replaced by `JsonPath`\n */\nexport class Data {\n  /**\n   * Instead of using a literal string, get the value from a JSON path\n   */\n  public static stringAt(path: string): string {\n    validateDataPath(path);\n    return new JsonPathToken(path).toString();\n  }\n\n  /**\n   * Instead of using a literal string list, get the value from a JSON path\n   */\n  public static listAt(path: string): string[] {\n    validateDataPath(path);\n    return Token.asList(new JsonPathToken(path));\n  }\n\n  /**\n   * Instead of using a literal number, get the value from a JSON path\n   */\n  public static numberAt(path: string): number {\n    validateDataPath(path);\n    return Token.asNumber(new JsonPathToken(path));\n  }\n\n  /**\n   * Use the entire data structure\n   *\n   * Will be an object at invocation time, but is represented in the CDK\n   * application as a string.\n   */\n  public static get entirePayload(): string {\n    return new JsonPathToken('$').toString();\n  }\n\n  /**\n   * Determines if the indicated string is an encoded JSON path\n   *\n   * @param value string to be evaluated\n   */\n  public static isJsonPathString(value: string): boolean {\n    return !!jsonPathString(value);\n  }\n\n  private constructor() {}\n}\n\n/**\n * Extract a field from the State Machine Context data\n *\n * @see https://docs.aws.amazon.com/step-functions/latest/dg/connect-to-resource.html#wait-token-contextobject\n *\n * @deprecated replaced by `JsonPath`\n */\nexport class Context {\n  /**\n   * Instead of using a literal string, get the value from a JSON path\n   */\n  public static stringAt(path: string): string {\n    validateContextPath(path);\n    return new JsonPathToken(path).toString();\n  }\n\n  /**\n   * Instead of using a literal number, get the value from a JSON path\n   */\n  public static numberAt(path: string): number {\n    validateContextPath(path);\n    return Token.asNumber(new JsonPathToken(path));\n  }\n\n  /**\n   * Return the Task Token field\n   *\n   * External actions will need this token to report step completion\n   * back to StepFunctions using the `SendTaskSuccess` or `SendTaskFailure`\n   * calls.\n   */\n  public static get taskToken(): string {\n    return new JsonPathToken('$$.Task.Token').toString();\n  }\n\n  /**\n   * Use the entire context data structure\n   *\n   * Will be an object at invocation time, but is represented in the CDK\n   * application as a string.\n   */\n  public static get entireContext(): string {\n    return new JsonPathToken('$$').toString();\n  }\n\n  private constructor() {}\n}\n\n/**\n * Helper functions to work with structures containing fields\n */\nexport class FieldUtils {\n  /**\n   * Render a JSON structure containing fields to the right StepFunctions structure\n   */\n  public static renderObject(obj?: { [key: string]: any }): { [key: string]: any } | undefined {\n    return renderObject(obj);\n  }\n\n  /**\n   * Return all JSON paths used in the given structure\n   */\n  public static findReferencedPaths(obj?: { [key: string]: any }): string[] {\n    return Array.from(findReferencedPaths(obj)).sort();\n  }\n\n  /**\n   * Returns whether the given task structure contains the TaskToken field anywhere\n   *\n   * The field is considered included if the field itself or one of its containing\n   * fields occurs anywhere in the payload.\n   */\n  public static containsTaskToken(obj?: { [key: string]: any }): boolean {\n    const paths = findReferencedPaths(obj);\n    return paths.has('$$.Task.Token') || paths.has('$$.Task') || paths.has('$$');\n  }\n\n  private constructor() {}\n}\n\nfunction validateJsonPath(path: string) {\n  if (path !== '$'\n    && !path.startsWith('$.')\n    && path !== '$$'\n    && !path.startsWith('$$.')\n    && !path.startsWith('$[')\n    && ['Format', 'StringToJson', 'JsonToString', 'Array'].every(fn => !path.startsWith(`States.${fn}`))\n  ) {\n    throw new Error(`JSON path values must be exactly '$', '$$', start with '$.', start with '$$.', start with '$[', or start with an intrinsic function: States.Format, States.StringToJson, States.JsonToString, or States.Array. Received: ${path}`);\n  }\n}\n\nfunction validateDataPath(path: string) {\n  if (path !== '$' && !path.startsWith('$.')) {\n    throw new Error(\"Data JSON path values must either be exactly equal to '$' or start with '$.'\");\n  }\n}\n\nfunction validateContextPath(path: string) {\n  if (path !== '$$' && !path.startsWith('$$.')) {\n    throw new Error(\"Context JSON path values must either be exactly equal to '$$' or start with '$$.'\");\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
