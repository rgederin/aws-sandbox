{
  "version": 3,
  "sources": ["index.ts"],
  "sourcesContent": ["// eslint-disable-next-line import/no-extraneous-dependencies\nimport * as AWS from 'aws-sdk';\n\nconst client = new AWS.CodePipeline({ apiVersion: '2015-07-09' });\nconst TIMEOUT_IN_MINUTES = 5;\n\nconst sleep = (seconds: number) => {\n  return new Promise<void>(resolve => setTimeout(resolve, seconds * 1000));\n};\n\nexport async function handler(event: any, _context: any) {\n  const {\n    PipelineName: pipelineName,\n    StageName: stageName,\n    ActionName: actionName,\n  } = event;\n\n  function parseState(response: any): string | undefined {\n    const stages = response.stageStates;\n    const validStages = stages?.filter((s: any) => s.stageName === stageName);\n    const manualApproval = validStages.length &&\n      validStages[0].actionStates.filter((state: any) => state.actionName === actionName);\n    const latest = manualApproval && manualApproval.length &&\n      manualApproval[0].latestExecution;\n\n    return latest ? latest.token : undefined;\n  }\n\n  const deadline = Date.now() + TIMEOUT_IN_MINUTES * 60000;\n  while (Date.now() < deadline) {\n    const response = await client.getPipelineState({ name: pipelineName }).promise();\n    const token = parseState(response);\n    if (token) {\n      await client.putApprovalResult({\n        pipelineName,\n        actionName,\n        stageName,\n        result: {\n          summary: 'No security changes detected. Automatically approved by Lambda.',\n          status: 'Approved',\n        },\n        token,\n      }).promise();\n      return;\n    }\n    await sleep(5);\n  }\n}\n"],
  "mappings": "2FACA,KAAA,KAAA,QAAA,WAEM,OAAS,GAAI,KAAI,aAAa,CAAE,WAAY,eAC5C,mBAAqB,EAErB,MAAQ,AAAC,SACN,GAAI,SAAc,SAAW,WAAW,QAAS,QAAU,MAG7D,uBAAuB,MAAY,SAAa,CACrD,KAAM,CACJ,aAAc,aACd,UAAW,UACX,WAAY,YACV,MAEJ,oBAAoB,SAAa,CAC/B,KAAM,QAAS,SAAS,YAClB,YAAc,QAAM,KAAA,OAAN,OAAQ,OAAO,AAAC,GAAW,EAAE,YAAc,WACzD,eAAiB,YAAY,QACjC,YAAY,GAAG,aAAa,OAAO,AAAC,OAAe,MAAM,aAAe,YACpE,OAAS,gBAAkB,eAAe,QAC9C,eAAe,GAAG,gBAEpB,MAAO,QAAS,OAAO,MAAQ,OAGjC,KAAM,UAAW,KAAK,MAAQ,mBAAqB,IACnD,KAAO,KAAK,MAAQ,UAAU,CAC5B,KAAM,UAAW,KAAM,QAAO,iBAAiB,CAAE,KAAM,eAAgB,UACjE,MAAQ,WAAW,UACzB,GAAI,MAAO,CACT,KAAM,QAAO,kBAAkB,CAC7B,aACA,WACA,UACA,OAAQ,CACN,QAAS,kEACT,OAAQ,YAEV,QACC,UACH,OAEF,KAAM,OAAM,IAnChB,QAAA,QAAA",
  "names": []
}
